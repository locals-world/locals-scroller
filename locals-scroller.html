<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../locals-avatar/locals-avatar.html">
<link rel="import" href="../locals-objectrender/locals-objectrender.html">

<!--
The scroller! 

Example:

    <locals-scroller></locals-scroller>

@group Seed Elements
@element locals-scroller
@demo demo/index.html
@hero hero.svg
-->
<dom-module id="locals-scroller">

  <template>
    <style>
      :host {
        display: block;
        width: 100vw;
        height: 20%;
/*        height: 100vh;*/
        color: white;
      }

      .canvas {
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        overflow-y: scroll;
      }


      .abs {
        position: absolute;
        top: 0;
        left: 0;
      }

      locals-objectrender {
        /*border: 1px solid red;*/
      }
    </style>
    <iron-pages selected="{{page}}" id="pages">
      <section>
        <div class="canvas" id="fooContainer">
          <template is="dom-repeat" items="{{dataset}}">
            <locals-objectrender key="{{dataset.key}}" objectdata="{{item}}" class="foo"></locals-objectrender>
          </template>
<!--           <locals-avatar class="foo"></locals-avatar>
          <locals-avatar class="foo"></locals-avatar> -->
        </div>
      </section>

      <section>
        <div class="canvas">
          <p on-tap="back">x</p>
          <h1 class="selectedobject"">{{selectedobject.component.name}}</h1>
        </div>
      </section>

    </iron-pages>

  </template>

</dom-module>

<script src="//cdn.jsdelivr.net/scrollreveal.js/3.1.4/scrollreveal.min.js"></script>
<script>

  Polymer({

    is: 'locals-scroller',

    properties: {

      /**
      * `objects` the array of objects to be rendered.
      */
      objects: {
        type: Array,
        observer: '_objects'
      },

      /**
      * Start rendering objects as from:
      */
      startnum: Number,

      /**
      * End rendering objects:
      */
      endnum: Number,

      /**
      * The selected object:
      */
      selected: Number

    },

    // Element Lifecycle

    ready: function() {
      this.page = 0;

      // `ready` is called after all elements have been configured, but
      // propagates bottom-up. This element's children are ready, but parents
      // are not.
      //
      // This is the point where you should make modifications to the DOM (when
      // necessary), or kick off any processes the element wants to perform.
    },

    attached: function() {
      // `attached` fires once the element and its parents have been inserted
      // into a document.
      //
      // This is a good place to perform any work related to your element's
      // visual state or active behavior (measuring sizes, beginning animations,
      // loading resources, etc).
      //this.renderObjects(this.objects, this.startnum, this.endnum);

      window.sr = ScrollReveal({distance: 0, origin: 'top', scale: 0.4, reset: true});
      var fooContainer = document.getElementById('fooContainer');
      sr.reveal('.foo', { opacity: 1, easing: 'cubic-bezier(0.150, 0.450, 0.150, 0.735)', viewFactor:0.1, duration: 300,
            delay: 0, container: fooContainer, distance: 0, origin: 'top', scale: 0.6, reset: true });
    },

    detached: function() {
      // The analog to `attached`, `detached` fires when the element has been
      // removed from a document.
      //
      // Use this to clean up anything you did in `attached`.
    },

    // Element Behavior

    renderObjects: function(objects, start, end){

    },

    _objects: function(){
      this.dataset = this.object2array(this.objects);
    },



    /**
     * The `object-selected` event is fired whenever `selectobject` is called.
     *
     * @event object-selected
     * @detail {{object: Number}}
     */

    

    /**
     * When an object is selected, fire an event.
     */
    selectobject: function(e) {
      console.log(e.target.id);
      this.selectedobject = this.dataset[e.target.id];
      console.log(this.selectedobject);
      //this.page = 1;
      this.fire('object-selected', {object: this.selectedobject});
    },

    back: function(){
      this.page = 0;
    },

    object2array: function(input){
      var newarray = [];
      var p = input;
      var previewdata = Object.keys(input);
      //console.log('Object2array: ',previewdata);
      for (var key in p) {        
        if (p.hasOwnProperty(key)) {
          newarray.key = key;
          newarray.push(p[key]);
          console.log(newarray);
        }
      };
      return newarray;
    }

  });

</script>
